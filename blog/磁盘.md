#### 所有命令

```
mount
lsblk
blkid
fdisk		 ===> MBR
echo '- - -'> /sys/class/scsi_host/host2/scan
uuidgen
parted
hexdump -C -n 512 /dev/sda
gdisk -l
gdisk /dev/sdd.   ===> GPT
mkfs.ext4 /dev/sdc2
tune2fs -l /dev/sdc5
mount -o nosuid,acl /dev/sdc2 /mnt/sdc2
sync
findmnt /dev/sdd
lsof MOUNT_POINT
fuser -v MOUNT_POINT
fuser -km MOUNT_POINT
umount MOUNT_POINT
showmount -e 10.211.55.82
echo $?
partprobe /dev/sda
partx -a /dev/sda  ====> centos6 分区后没有同步，使用命令同步
```



```
分区 -- 分区表 -- 文件系统 -- 
FAT32 -- 硬盘 <4G
ext4 NTFS -- u盘 
```

#### 管理分区

- 查看内存的分区表

```
lsblk
cat /proc/partitions 
ls /dev/sd* 
```

- 查看硬盘上的分区表

```
fdisk /dev/sdc -l 
```

- 列出块设备 

-  **lsblk**
- 创建分区使用:
  - fdisk 创建MBR分区 
  - gdisk 创建GPT分区
  - parted 高级分区操作
- partprobe -->新设置内存中的内核分区表版本

```
[root@node ~]$ ls -l /dev/sd*
brw-rw---- 1 root disk 8,  0 Dec 12 10:41 /dev/sda
brw-rw---- 1 root disk 8,  1 Dec 12 10:41 /dev/sda1
brw-rw---- 1 root disk 8,  2 Dec 12 10:41 /dev/sda2
brw-rw---- 1 root disk 8, 16 Dec 27 14:23 /dev/sdb
brw-rw---- 1 root disk 8, 32 Dec 27 14:24 /dev/sdc
[root@node ~]$ ls -l /dev/zero
crw-rw-rw- 1 root root 1, 5 Dec 12 10:41 /dev/zero

[root@node ~]$fdisk -l /dev/sda

Disk /dev/sda: 68.7 GB, 68719476736 bytes, 134217728 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 4096 bytes
I/O size (minimum/optimal): 4096 bytes / 4096 bytes
Disk label type: dos
Disk identifier: 0x0009fd8d

   Device Boot      Start         End      Blocks   Id  System
/dev/sda1   *        2048     1026047      512000   83  Linux
/dev/sda2         1026048   134217727    66595840   8e  Linux LVM
```



- 添加两块磁盘[不划分分区]

```
# 识别添加的新磁盘
echo '- - -'> /sys/class/scsi_host/host2/scan
fdisk -l
fdisk -l /dev/sda

# 按照ext4 格式化 /dev/sdb
[root@node ~]$mkfs.ext4 /dev/sdb

# 查看文件系统
[root@node ~]$blkid
/dev/sdb: UUID="643f4945-de39-409a-8554-fd89ebb87b70" TYPE="ext4" 
[root@node ~]$mkdir /mnt/sdb
[root@node ~]$cd /mnt/sdb
[root@node sdb]$mount /dev/sdb /mnt/sdb 
[root@node sdb]$df -h
Filesystem                    Size  Used Avail Use% Mounted on
/dev/mapper/VolGroup-lv_root   50G  5.8G   41G  13% /
/dev/sdb                      8.8G   37M  8.3G   1% /mnt/sdb
```

- 磁盘分区
	- 为什么分区
	  - 优化I/O性能
	  - 实现磁盘空间配额限制 
	  - 提高修复速度
	  - 隔离系统和程序
	  - 安装多个OS
	  - 采用不同文件系统

- 分区
	- 两种分区方式:MBR，GPT
	- 如何分区:按柱面
	- 0磁道0扇区:512bytes
	  - 446bytes: boot loader 
	  - 64bytes:分区表
	    - 16bytes: 标识一个分区 
	  - 2bytes: 55AA
	  	- `hexdump -C -n 512 /dev/sda`
	- 4个主分区;3主分区+1扩展(N个逻辑分区)

```
[root@node sdb]$uuidgen
deff6298-51f2-413b-a213-63925f75a3c5
```

```
BIOS+MDR
BIOS+GPT 错误
BISO+MDR sda + sdb GPT
UEFI+GPT
```



#### parted命令

- ==parted的操作都是实时生效的，小心使用==
- 用法:parted [选项]... [设备 [命令 [参数]...]...]
  -   ```
  	parted /dev/sdb mklabel gpt|msdos
  	parted /dev/sdb print
  	parted /dev/sdb mkpart primary 1 200 (默认M) parted /dev/sdb rm 1
  	parted -l
  	```

##### 实验

```bash
[root@node sdb]$hexdump -C -n 512 /dev/sda
[root@node sdb]$parted  /dev/sdc mklabel gpt 
Information: You may need to update /etc/fstab.
[root@node sdb]$hexdump -C -n 512 /dev/sda
[root@node sdb]$hexdump -C -n 1024 /dev/sda
[root@node sdb]$parted /dev/sdc print
[root@node sdb]$parted /dev/sdc mkpart primary 1 1024
[root@node sdb]$parted /dev/sdc print        
Model: ATA RHEL-bak-1 SSD (scsi)
Disk /dev/sdc: 68.7GB
Sector size (logical/physical): 512B/4096B
Partition Table: gpt
Disk Flags: 

Number  Start   End     Size    File system  Name     Flags
 1      1049kB  1024MB  1023MB               primary
[root@node ~]$lsblk 
NAME                 MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                    8:0    0   64G  0 disk 
|-sda1                 8:1    0  500M  0 part /boot
`-sda2                 8:2    0 63.5G  0 part 
  |-VolGroup-lv_root 253:0    0   50G  0 lvm  /
  |-VolGroup-lv_swap 253:1    0    2G  0 lvm  [SWAP]
  `-VolGroup-lv_home 253:2    0 11.6G  0 lvm  /home
sdb                    8:16   0    9G  0 disk /mnt/sdb
sdc                    8:32   0   64G  0 disk 
`-sdc1                 8:33   0  976M  0 part 
[root@node ~]$parted /dev/sdc mkpart primary 1024 2048
Information: You may need to update /etc/fstab.

[root@node ~]$parted /dev/sdc print 
Model: ATA RHEL-bak-1 SSD (scsi)
Disk /dev/sdc: 68.7GB
Sector size (logical/physical): 512B/4096B
Partition Table: gpt
Disk Flags: 

Number  Start   End     Size    File system  Name     Flags
 1      1049kB  1024MB  1023MB               primary
 2      1024MB  2048MB  1023MB               primary
[root@node ~]$fdisk -l /dev/sdc
WARNING: fdisk GPT support is currently new, and therefore in an experimental phase. Use at your own discretion.

Disk /dev/sdc: 68.7 GB, 68719476736 bytes, 134217728 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 4096 bytes
I/O size (minimum/optimal): 4096 bytes / 4096 bytes
Disk label type: gpt
Disk identifier: 431052E8-2267-455F-81E9-D5F3E2D44790


#         Start          End    Size  Type            Name
 1         2048      2000895    976M  Microsoft basic primary
 2      2000896      3999743    976M  Microsoft basic primary
[root@node ~]$gdisk -l /dev/sdc 
GPT fdisk (gdisk) version 0.8.6

Partition table scan:
  MBR: protective
  BSD: not present
  APM: not present
  GPT: present

Found valid GPT with protective MBR; using GPT.
Disk /dev/sdc: 134217728 sectors, 64.0 GiB
Logical sector size: 512 bytes
Disk identifier (GUID): 431052E8-2267-455F-81E9-D5F3E2D44790
Partition table holds up to 128 entries
First usable sector is 34, last usable sector is 134217694
Partitions will be aligned on 2048-sector boundaries
Total free space is 130219965 sectors (62.1 GiB)

Number  Start (sector)    End (sector)  Size       Code  Name
   1            2048         2000895   976.0 MiB   0700  primary
   2         2000896         3999743   976.0 MiB   0700  primary
[root@node ~]$parted /dev/sdc mklabel msdos 
Warning: The existing disk label on /dev/sdc will be destroyed and all data on this disk will be lost. Do you want to continue?
Yes/No? y                                                                 
Information: You may need to update /etc/fstab.
[root@node ~]$parted /dev/sdc print        
Model: ATA RHEL-bak-1 SSD (scsi)
Disk /dev/sdc: 68.7GB
Sector size (logical/physical): 512B/4096B
Partition Table: msdos
Disk Flags: 

Number  Start  End  Size  Type  File system  Flags
[root@node ~]$gdisk -l /dev/sdc      

[root@node ~]$gdisk /dev/sdc 
GPT fdisk (gdisk) version 0.8.6

Partition table scan:
  MBR: MBR only
  BSD: not present
  APM: not present
  GPT: not present


***************************************************************
Found invalid GPT and valid MBR; converting MBR to GPT format.
THIS OPERATION IS POTENTIALLY DESTRUCTIVE! Exit by typing 'q' if
you don't want to convert your MBR partitions to GPT format!
***************************************************************


Command (? for help): ?
b       back up GPT data to a file
c       change a partition's name
d       delete a partition
i       show detailed information on a partition
l       list known partition types
n       add a new partition
o       create a new empty GUID partition table (GPT)
p       print the partition table
q       quit without saving changes
r       recovery and transformation options (experts only)
s       sort partitions
t       change a partition's type code
v       verify disk
w       write table to disk and exit
x       extra functionality (experts only)
?       print this menu

Command (? for help): p
Disk /dev/sdc: 134217728 sectors, 64.0 GiB
Logical sector size: 512 bytes
Disk identifier (GUID): 9CA6648D-1DF2-46C9-A3AF-DDBC577F0A31
Partition table holds up to 128 entries
First usable sector is 34, last usable sector is 134217694
Partitions will be aligned on 2048-sector boundaries
Total free space is 134217661 sectors (64.0 GiB)

Number  Start (sector)    End (sector)  Size       Code  Name

Command (? for help): n
Partition number (1-128, default 1): 1
First sector (34-134217694, default = 2048) or {+-}size{KMGTP}: 
Last sector (2048-134217694, default = 134217694) or {+-}size{KMGTP}: +1G
Current type is 'Linux filesystem'
Hex code or GUID (L to show codes, Enter = 8300): 
Changed type of partition to 'Linux filesystem'

Command (? for help): ?
b       back up GPT data to a file
c       change a partition's name
d       delete a partition
i       show detailed information on a partition
l       list known partition types
n       add a new partition
o       create a new empty GUID partition table (GPT)
p       print the partition table
q       quit without saving changes
r       recovery and transformation options (experts only)
s       sort partitions
t       change a partition's type code
v       verify disk
w       write table to disk and exit
x       extra functionality (experts only)
?       print this menu

Command (? for help): w

Final checks complete. About to write GPT data. THIS WILL OVERWRITE EXISTING
PARTITIONS!!

Do you want to proceed? (Y/N): y
OK; writing new GUID partition table (GPT) to /dev/sdc.
The operation has completed successfully.
[root@node ~]$gdisk -l /dev/sdc    
GPT fdisk (gdisk) version 0.8.6

Partition table scan:
  MBR: protective
  BSD: not present
  APM: not present
  GPT: present

Found valid GPT with protective MBR; using GPT.
Disk /dev/sdc: 134217728 sectors, 64.0 GiB
Logical sector size: 512 bytes
Disk identifier (GUID): 9CA6648D-1DF2-46C9-A3AF-DDBC577F0A31
Partition table holds up to 128 entries
First usable sector is 34, last usable sector is 134217694
Partitions will be aligned on 2048-sector boundaries
Total free space is 132120509 sectors (63.0 GiB)

Number  Start (sector)    End (sector)  Size       Code  Name
   1            2048         2099199   1024.0 MiB  8300  Linux filesystem
[root@node ~]$fdisk -l /dev/sdc             
WARNING: fdisk GPT support is currently new, and therefore in an experimental phase. Use at your own discretion.

Disk /dev/sdc: 68.7 GB, 68719476736 bytes, 134217728 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 4096 bytes
I/O size (minimum/optimal): 4096 bytes / 4096 bytes
Disk label type: gpt
Disk identifier: 9CA6648D-1DF2-46C9-A3AF-DDBC577F0A31


#         Start          End    Size  Type            Name
 1         2048      2099199      1G  Linux filesyste Linux filesystem
[root@node ~]$hexdump -C -n 512 /dev/sdc
00000000  fa b8 00 10 8e d0 bc 00  b0 b8 00 00 8e d8 8e c0  |................|
00000010  fb be 00 7c bf 00 06 b9  00 02 f3 a4 ea 21 06 00  |...|.........!..|
00000020  00 be be 07 38 04 75 0b  83 c6 10 81 fe fe 07 75  |....8.u........u|
00000030  f3 eb 16 b4 02 b0 01 bb  00 7c b2 80 8a 74 01 8b  |.........|...t..|
00000040  4c 02 cd 13 ea 00 7c 00  00 eb fe 00 00 00 00 00  |L.....|.........|
00000050  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
*
000001c0  02 00 ee ff ff ff 01 00  00 00 ff ff ff 07 00 00  |................|
000001d0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
*
000001f0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 55 aa  |..............U.|
00000200
# 有55 aa 说明有分区表；没有55 aa 就没有分区表；其实清空55 aa 就代表分区表就没了
[root@node ~]$dd if=/dev/zero of=/dev/sdc bs=1 count=2 skip=210 seek=510
2+0 records in
2+0 records out
2 bytes (2 B) copied, 0.00043364 s, 4.6 kB/s
[root@node ~]$hexdump -C -n 512 /dev/sdc                                         
00000000  fa b8 00 10 8e d0 bc 00  b0 b8 00 00 8e d8 8e c0  |................|
00000010  fb be 00 7c bf 00 06 b9  00 02 f3 a4 ea 21 06 00  |...|.........!..|
00000020  00 be be 07 38 04 75 0b  83 c6 10 81 fe fe 07 75  |....8.u........u|
00000030  f3 eb 16 b4 02 b0 01 bb  00 7c b2 80 8a 74 01 8b  |.........|...t..|
00000040  4c 02 cd 13 ea 00 7c 00  00 eb fe 00 00 00 00 00  |L.....|.........|
00000050  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
*
000001c0  02 00 ee ff ff ff 01 00  00 00 ff ff ff 07 00 00  |................|
000001d0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
*
00000200
[root@node ~]$fdisk -l /dev/sdc                          
[root@node ~]$gdisk -l /dev/sdc  
[root@node ~]$dd if=/dev/zero of=/dev/sdc bs=1 count=512                
512+0 records in
512+0 records out
512 bytes (512 B) copied, 0.00176138 s, 291 kB/s
[root@node ~]$gdisk -l /dev/sdc                         
GPT fdisk (gdisk) version 0.8.6

Partition table scan:
  MBR: not present
  BSD: not present
  APM: not present
  GPT: present

Found valid GPT with corrupt MBR; using GPT and will write new
protective MBR on save.
Disk /dev/sdc: 134217728 sectors, 64.0 GiB
Logical sector size: 512 bytes
Disk identifier (GUID): 9CA6648D-1DF2-46C9-A3AF-DDBC577F0A31
Partition table holds up to 128 entries
First usable sector is 34, last usable sector is 134217694
Partitions will be aligned on 2048-sector boundaries
Total free space is 132120509 sectors (63.0 GiB)

Number  Start (sector)    End (sector)  Size       Code  Name
   1            2048         2099199   1024.0 MiB  8300  Linux filesystem
[root@node ~]$fdisk -l /dev/sdc                       
```



#### 分区工具fdisk和gdisk

- `gfisk /dev/sdb` 类fdisk 的GPT分区工具 
- `fdisk -l [-u] [device...] `查看分区 
- `fdisk /dev/sdb` 管理分区
  - 子命令:
    - p 分区列表 
    - t 更改分区类型 
    - n 创建新分区 
    - d 删除分区 
    - v 校验分区 
    - u 转换单位 
    - w 保存并退出 
    - q 不保存并退出

#### 同步分区表

- 查看内核是否已经识别新的分区:
  - `cat /proc/partations`

- `centos6`通知内核重新读取硬盘分区表 
  - 新增分区用
  - `partx -a /dev/DEVICE`
  - `kpartx -a /dev/DEVICE -f: force`
  - 删除分区用
  - `partx -d --nr M-N /dev/DEVICE`
- `CentOS 5，7: 使用`
  - `partprobe [/dev/DEVICE]`




#### 文件系统

- 支持的文件系统 
	- `ls /lib/modules/3.10.0-693.el7.x86_64/kernel/fs`

```bash
[root@node ~]$mkfs.ext4 /dev/sdc2
mke2fs 1.42.9 (28-Dec-2013)
Discarding device blocks: done                            
Filesystem label=
OS type: Linux
Block size=4096 (log=2)
Fragment size=4096 (log=2)
Stride=0 blocks, Stripe width=0 blocks
1310720 inodes, 5242880 blocks
262144 blocks (5.00%) reserved for the super user
First data block=0
Maximum filesystem blocks=2153775104
160 block groups
32768 blocks per group, 32768 fragments per group
8192 inodes per group
Superblock backups stored on blocks: 
        32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208, 
        4096000

Allocating group tables: done                            
Writing inode tables: done                            
Creating journal (32768 blocks): done
Writing superblocks and filesystem accounting information: done   
[root@node ~]$blkid
/dev/sda1: UUID="4ca44198-e9c0-4267-aaf9-72cf981061fc" TYPE="ext4" 
/dev/sdb: UUID="643f4945-de39-409a-8554-fd89ebb87b70" TYPE="ext4" 
/dev/sdc2: UUID="2a7eae02-13f5-4a15-96ef-e20d3e7d49c2" TYPE="ext4" 
[root@node ~]$lsblk -f
[root@node ~]$mkfs.ext2 /dev/sdc2
[root@node ~]$lsblk -f 
[root@node ~]$blkid
[root@node ~]$tune2fs -l /dev/sdc2

[root@node ~]$mkfs.ext3 /dev/sdc5
[root@node ~]$tune2fs -l /dev/sdc5

# ext2 --> ext3
[root@node ~]$lsblk -f
[root@node ~]$blkid
[root@node ~]$tune2fs -l /dev/sdc2
[root@node ~]$tune2fs -O has_journal /dev/sdc2
[root@node ~]$tune2fs -l /dev/sdc2
[root@node ~]$lsblk -f            
[root@node ~]$blkid

# ext3 --> ext2
[root@node ~]$lsblk -f
[root@node ~]$blkid
[root@node ~]$tune2fs -l /dev/sdc2
[root@node ~]$tune2fs -O ^has_journal /dev/sdc2
[root@node ~]$tune2fs -l /dev/sdc2
[root@node ~]$lsblk -f            
[root@node ~]$blkid

[root@node ~]$blkid -U ad9f9b75-fdba-4de8-acf2-82adeb47322a  
/dev/sdc5

[root@node ~]$tune2fs -l /dev/sdc5

[root@node ~]$fsck /dev/sdc5
[root@node ~]$fsck -f /dev/sdc5 
```



#### 挂载mount

- `mount DEVICE MOUNT_POINT`

- `mount:通过查看/etc/mtab文件显示当前已挂载的所有设备`

- `mount常用命令选项`
	- -o options:(挂载文件系统的选项)，多个选项使用逗号分隔 
	  - async:异步模式
	  - sync:同步模式,内存更改时，同时写磁盘 
	  - atime/noatime:包含目录和文件  ==挂载后不更改时间，提高性能【应用场景：web网站目录 +5%性能】==
	  - diratime/nodiratime:目录的访问时间戳 
	  - auto/noauto:是否支持自动挂载,是否支持-a选项 
	  - exec/noexec:是否支持将文件系统上运行应用程序 
	  - dev/nodev:是否支持在此文件系统上使用设备文件 
	  - suid/nosuid:不否支持suid和sgid权限 
	  - remount:重新挂载
	  - ro:只读
	  - rw:读写 
	  - user/nouser:是否允许普通用户挂载此设备，/etc/fstab使用 
	  - acl:启用此文件系统上的acl功能
	  - loop: 使用loop设备
	- defaults:相当于rw, nosuid, dev, exec, auto, nouser, async

```
[root@node ~]$mount -o nosuid,acl /dev/sdc2 /mnt/sdc2

[root@node ~]$mount |grep sdc2
/dev/sdc2 on /mnt/sdc2 type ext3 (rw,nosuid,relatime,data=ordered)
```

#### 格式化u盘,实验

- 取消挂载

```
[root@node ~]$lsblk 
NAME                 MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                    8:0    0   64G  0 disk 
|-sda1                 8:1    0  500M  0 part /boot
`-sda2                 8:2    0 63.5G  0 part 
  |-VolGroup-lv_root 253:0    0   50G  0 lvm  /
  |-VolGroup-lv_swap 253:1    0    2G  0 lvm  [SWAP]
  `-VolGroup-lv_home 253:2    0 11.6G  0 lvm  /home
sdb                    8:16   0    9G  0 disk 
sdc                    8:32   0   64G  0 disk 
|-sdc1                 8:33   0   10G  0 part 
|-sdc2                 8:34   0   20G  0 part /mnt/sdc2
|-sdc3                 8:35   0    1K  0 part 
`-sdc5                 8:37   0   34G  0 part 
sdd                    8:48   0   64G  0 disk 

# 格式化
[root@node ~]$mkfs.ext4 /dev/sdd
mke2fs 1.42.9 (28-Dec-2013)
/dev/sdd is entire device, not just one partition!
Proceed anyway? (y,n) y
[root@node ~]$blkid|grep sdd
/dev/sdd: UUID="8e5b0ca3-e128-47dc-8c3b-901e592a2077" TYPE="ext4" 
[root@node ~]$mkdir -pv /mnt/sdd   
mkdir: created directory '/mnt/sdd'
[root@node ~]$mount /dev/sdd /mnt/sdd
[root@node sdd]$cp /bin/cat /bin/vi .
[root@node sdd]$ls
cat  lost+found  vi
[root@node sdd]$chmod u+s *
[root@node sdd]$sync
[root@node sdd]$sync
[root@node mnt]$umount /mnt/sdd
# 拔下u盘；插到别的机器

[root@node mnt]$mount /dev/sdd /mnt/sdd
[root@node sdd]$./cat /etc/shadow
[root@node sdd]$mount|grep sdd 
/dev/sdd on /mnt/sdd type ext4 (rw,relatime,data=ordered)

```

#### 查看挂载情况

```
[root@node sdd]$findmnt /dev/sdd
TARGET   SOURCE   FSTYPE OPTIONS
/mnt/sdd /dev/sdd ext4   rw,relatime,data=ordered
```

#### 查看正在访问指定文件系统的进程

```
lsof MOUNT_POINT
fuser -v MOUNT_POINT
```

- 终止所有在正访问指定的文件系统的进程

```
fuser -km MOUNT_POINT
```

- 卸载

```
umount DEVICE
umount MOUNT_POINT
```



### 挂载点和/etc/fstab

- 配置文件系统体系
- 被mount、fsck和其它程序使用
- 系统重启时保留文件系统体系
- 可以在设备栏使用文件系统卷标
- 使用mount -a 命令挂载/etc/fstab中的所有文件系统

#### 文件挂载配置文件

- /etc/fstab每行定义一个要挂载的文件系统 
- 要挂载的设备或伪文件系统
  - 设备文件
  - LABEL:LABEL="" 
  - UUID:UUID="" 
  - 伪文件系统名称:proc, sysfs
- 挂载点
- 文件系统类型
- 挂载选项:defaults
- 转储频率:0:不做备份 1:每天转储 2:每隔一天转储 
- 自检次序: 0:不自检
  - 1:首先自检;一般只有rootfs才用1

```
[root@node ~]$cat /etc/fstab    
/dev/sdc2                                       /mnt/sdc2 ext4 defaults 0 3 
# 添加上面一行
[root@node ~]$mount -a
[root@node ~]$mount |grep sdc2
```

- ==结论==
	- ==设备名是容易改变的 uuid是不易改变的==
	- ==最后检查最好写0==

```
[root@node ~]$cat /etc/fstab
/dev/sdd            /mnt/sdd                ext4    suid,acl             0 0
:r!blkid /dev/sdd
[root@node ~]$mount f1 /mnt/f1 
[root@node ~]$mount -o loop f1 /mnt/f1
[root@node ~]$umount /mnt/f1
[root@node ~]$cat /etc/fstab
/root/f1                /mnt/f1                  ext4    loop          0  0
10.211.55.82:/mnt/nfs   /mnt/nfs                 nfs     defaults      0  0

[root@node ~]$showmount -e 10.211.55.82
# nfs资源开机自检的时候是不会强制检测的 
# 挂载 对应资源 文件系统不一致的时候 挂载会出问题的

[root@node tmp]$findmnt /dev/sdd
TARGET   SOURCE   FSTYPE OPTIONS
/mnt/sdd /dev/sdd ext4   rw,nosuid,relatime,data=ordered
[root@node tmp]$findmnt -s /dev/sdd
[root@node tmp]$findmnt /dev/sdd
TARGET   SOURCE   FSTYPE OPTIONS
/mnt/sdd /dev/sdd ext4   rw,nosuid,relatime,data=ordered
[root@node tmp]$echo $?
0
```



### Swap挂载交换分区

- 交换分区是系统RAM的补充 
- 基本设置包括:
  - 创建交换分区或者文件
  - 使用mkswap写入特殊签名
  - 在/etc/fstab文件中添加适当的条目 
  - 使用swapon -a 激活交换空间

- 启用:swapon
  - swapon [OPTION]... [DEVICE]
    - -a:激活所有的交换分区; 
    - -p PRIORITY:指定优先级 /
    - etc/fstab:pri=value
- 禁用:`swapoff [OPTION]... [DEVICE]`

#### 穿件swap分区并使用

```
[root@node tmp]$free -h
              total        used        free      shared  buff/cache   available
Mem:           2.0G        603M        930M        8.5M        538M        1.2G
Swap:          2.0G          0B        2.0G
[root@node tmp]$fdisk /dev/sdc
Command (m for help): n
Partition type:
   p   primary (2 primary, 1 extended, 1 free)
   l   logical (numbered from 5)
Select (default p): l
Adding logical partition 5
First sector (62918656-134217727, default 62918656): 
Using default value 62918656
Last sector, +sectors or +size{K,M,G} (62918656-134217727, default 134217727): +4G
Partition 5 of type Linux and of size 4 GiB is set

Command (m for help): p

Disk /dev/sdc: 68.7 GB, 68719476736 bytes, 134217728 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 4096 bytes
I/O size (minimum/optimal): 4096 bytes / 4096 bytes
Disk label type: dos
Disk identifier: 0xb6e8d882

   Device Boot      Start         End      Blocks   Id  System
/dev/sdc1            2048    20973567    10485760   83  Linux
/dev/sdc2        20973568    62916607    20971520   83  Linux
/dev/sdc3        62916608   134217727    35650560    5  Extended
/dev/sdc5        62918656    71307263     4194304   83  Linux

Command (m for help): t
Partition number (1-3,5, default 5): 
Hex code (type L to list all codes): L

 0  Empty           24  NEC DOS         81  Minix / old Lin bf  Solaris        
 1  FAT12           27  Hidden NTFS Win 82  Linux swap / So c1  DRDOS/sec (FAT-
 2  XENIX root      39  Plan 9          83  Linux           c4  DRDOS/sec (FAT-
 3  XENIX usr       3c  PartitionMagic  84  OS/2 hidden C:  c6  DRDOS/sec (FAT-
 4  FAT16 <32M      40  Venix 80286     85  Linux extended  c7  Syrinx         
 5  Extended        41  PPC PReP Boot   86  NTFS volume set da  Non-FS data    
 6  FAT16           42  SFS             87  NTFS volume set db  CP/M / CTOS / .
 7  HPFS/NTFS/exFAT 4d  QNX4.x          88  Linux plaintext de  Dell Utility   
 8  AIX             4e  QNX4.x 2nd part 8e  Linux LVM       df  BootIt         
 9  AIX bootable    4f  QNX4.x 3rd part 93  Amoeba          e1  DOS access     
 a  OS/2 Boot Manag 50  OnTrack DM      94  Amoeba BBT      e3  DOS R/O        
 b  W95 FAT32       51  OnTrack DM6 Aux 9f  BSD/OS          e4  SpeedStor      
 c  W95 FAT32 (LBA) 52  CP/M            a0  IBM Thinkpad hi eb  BeOS fs        
 e  W95 FAT16 (LBA) 53  OnTrack DM6 Aux a5  FreeBSD         ee  GPT            
 f  W95 Ext'd (LBA) 54  OnTrackDM6      a6  OpenBSD         ef  EFI (FAT-12/16/
10  OPUS            55  EZ-Drive        a7  NeXTSTEP        f0  Linux/PA-RISC b
11  Hidden FAT12    56  Golden Bow      a8  Darwin UFS      f1  SpeedStor      
12  Compaq diagnost 5c  Priam Edisk     a9  NetBSD          f4  SpeedStor      
14  Hidden FAT16 <3 61  SpeedStor       ab  Darwin boot     f2  DOS secondary  
16  Hidden FAT16    63  GNU HURD or Sys af  HFS / HFS+      fb  VMware VMFS    
17  Hidden HPFS/NTF 64  Novell Netware  b7  BSDI fs         fc  VMware VMKCORE 
18  AST SmartSleep  65  Novell Netware  b8  BSDI swap       fd  Linux raid auto
1b  Hidden W95 FAT3 70  DiskSecure Mult bb  Boot Wizard hid fe  LANstep        
1c  Hidden W95 FAT3 75  PC/IX           be  Solaris boot    ff  BBT            
1e  Hidden W95 FAT1 80  Old Minix      
Hex code (type L to list all codes): 82
Changed type of partition 'Linux' to 'Linux swap / Solaris'

Command (m for help): p

Disk /dev/sdc: 68.7 GB, 68719476736 bytes, 134217728 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 4096 bytes
I/O size (minimum/optimal): 4096 bytes / 4096 bytes
Disk label type: dos
Disk identifier: 0xb6e8d882

   Device Boot      Start         End      Blocks   Id  System
/dev/sdc1            2048    20973567    10485760   83  Linux
/dev/sdc2        20973568    62916607    20971520   83  Linux
/dev/sdc3        62916608   134217727    35650560    5  Extended
/dev/sdc5        62918656    71307263     4194304   82  Linux swap / Solaris

Command (m for help): w
The partition table has been altered!

Calling ioctl() to re-read partition table.
Syncing disks.
[root@node tmp]$lsblk |grep sdc 
sdc                    8:32   0   64G  0 disk 
|-sdc1                 8:33   0   10G  0 part 
|-sdc2                 8:34   0   20G  0 part 
|-sdc3                 8:35   0    1K  0 part 
`-sdc5                 8:37   0    4G  0 part 
[root@node tmp]$mkswap /dev/sdc5
mkswap: /dev/sdc5: warning: wiping old ext3 signature.
Setting up swapspace version 1, size = 4194300 KiB
no label, UUID=64626571-2941-4049-991b-f6299c75ff03
[root@node tmp]$blkid|grep sdc5
/dev/sdc5: UUID="64626571-2941-4049-991b-f6299c75ff03" TYPE="swap" 
[root@node tmp]$cat /etc/fstab
/dev/sdc5                       swap                    swap    defaults        0 0
[root@node tmp]$swapon -a 
[root@node tmp]$free -h
[root@node tmp]$lsblk |grep SWAP
  |-VolGroup-lv_swap 253:1    0    2G  0 lvm  [SWAP]
`-sdc5                 8:37   0    4G  0 part [SWAP]
[root@node tmp]$cat /proc/swaps  
Filename                                Type            Size    Used    Priority
/dev/dm-1                               partition       2064380 0       -1
/dev/sdc5                               partition       4194300 0       -2
# 值越大 优先级越高
[root@node tmp]$cat /etc/fstab      
/dev/sdc5                  swap                    swap     pri=10       0 0
[root@node tmp]$swapon -a
[root@node tmp]$cat /proc/swaps 
Filename                                Type            Size    Used    Priority
/dev/dm-1                               partition       2064380 0       -1
/dev/sdc5                               partition       4194300 0       -2
[root@node tmp]$swapon -s



# 删除
## 禁用分区
[root@node tmp]$swapoff /dev/sdc5
## vim /etc/fstab
## 删分区
fdisk/gdisk

```



### 迁移home至独立分区

```
1、分个新分区 + 创建新的文件系统
[root@node home]$fdisk /dev/sdc         
[root@node home]$partprobe /dev/sdc
[root@node home]$mkfs.ext4 /dev/sdc6 -L /home
[root@node home]$blkid|grep sdc6
/dev/sdc6: LABEL="/home" UUID="1d7d67ee-7f20-49ac-8395-a7548dae3248" TYPE="ext4" 
3、临时挂载+cp
[root@node ~]$mount /dev/sdc6 /mnt/home
[root@node ~]$cp -a /home/* /mnt/home/
4、切换单用户
init 1
[root@node ~]$rm -rf /home/*
[root@node ~]$cat /etc/fstab
UUID=1d7d67ee-7f20-49ac-8395-a7548dae3248 /home ext4 defaults  0 0

:r!blikd /dev/sdc6
init 3 或者 reboot
5、测试
[root@node ~]$su erlong
[erlong@node root]$ ls
ls: cannot open directory .: Permission denied
[erlong@node root]$ cd
[erlong@node ~]$ ls
Desktop
[erlong@node ~]$ exit
exit
```



### 为用户设定配额